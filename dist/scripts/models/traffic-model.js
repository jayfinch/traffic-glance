define(["require","backbone","lodash","../models/config-model","moment"],function(e){var t=e("backbone"),n=e("lodash"),r=e("../models/config-model"),a=e("moment"),o=t.Model.extend({initialize:function(e){this.coords=e.coords,this.configModel=r.instance()},url:function(){var e="http://dev.virtualearth.net/REST/V1/Routes/Driving?&";return e+="distanceUnit="+this.configModel.get("units")+"&",n.each(this.coords,function(t,n){e+=t.type+"."+n+"="+t.coordLat+","+t.coordLong+"&"}),e+="key="+this.configModel.get("key")},_parseLegDetails:function(){var e=["Accident","BlockedRoad","Congestion","DisabledVehicle","Miscellaneous","Other","OtherTrafficIncidents","PlannedEvents","RoadClosures","RoadHazard","ScheduledConstruction","SeasonalClosures","Weather"],t=this.get("resourceSets")[0].resources[0],r=t.routeLegs,a=[],o=0,s=0,i=0,c=0;return n.each(r,function(t){var r=t.itineraryItems;n.each(r,function(t){t.warnings?n.each(t.warnings,function(r){if("TrafficFlow"===r.warningType)switch(r.severity){case"Minor":s+=t.travelDistance;break;case"Low Impact":s+=t.travelDistance;break;case"Moderate":i+=t.travelDistance;break;case"Serious":c+=t.travelDistance;break;default:o+=t.travelDistance}else n.contains(e,r.warningType)&&(a=n.union(a,[r.text]))}):o+=t.travelDistance})}),{travelDurationByCongestion:{noCongestion:o,lowCongestion:s,moderateCongestion:i,seriousCongestion:c},travelWarnings:a}},_parseDurationStats:function(){var e=this.get("resourceSets")[0].resources[0].travelDurationTraffic,t=a.duration({seconds:e}),n=t.hours();t.subtract({hours:n});var r=t.minutes(),o=this.get("resourceSets")[0].resources[0].travelDistance;o=Math.round(10*o)/10;var s=a().add("s",e).format("h:mm a");return{travelDurationStats:{hours:n,minutes:r,distance:o,arriveTime:s}}},formatResults:function(){var e=this._parseDurationStats(),t=this._parseLegDetails(),r=n.extend(t,e);return r}});return o});
//# sourceMappingURL=traffic-model.js.map
!function(root){function Context(t,e,n,o){this.stack=t,this.global=e,this.blocks=n,this.templateName=o}function Stack(t,e,n,o){this.tail=e,this.isObject=t&&"object"==typeof t,this.head=t,this.index=n,this.of=o}function Stub(t){this.head=new Chunk(this),this.callback=t,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(t,e,n){this.root=t,this.next=e,this.data=[],this.flushable=!1,this.taps=n}function Tap(t,e){this.head=t,this.tail=e}var dust={},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",loggingLevels=[DEBUG,INFO,WARN,ERROR,NONE],EMPTY_FUNC=function(){},logger={},originalLog,loggerContext;dust.debugLevel=NONE,dust.silenceErrors=!1,root&&root.console&&root.console.log&&(loggerContext=root.console,originalLog=root.console.log),logger.log=loggerContext?function(){logger.log="function"==typeof originalLog?function(){originalLog.apply(loggerContext,arguments)}:function(){var t=Array.prototype.slice.apply(arguments).join(" ");originalLog(t)},logger.log.apply(this,arguments)}:function(){},dust.log=function(t,e){if(dust.isDebug&&dust.debugLevel===NONE&&(logger.log('[!!!DEPRECATION WARNING!!!]: dust.isDebug is deprecated.  Set dust.debugLevel instead to the level of logging you want ["debug","info","warn","error","none"]'),dust.debugLevel=INFO),e=e||INFO,dust.indexInArray(loggingLevels,e)>=dust.indexInArray(loggingLevels,dust.debugLevel)&&(dust.logQueue||(dust.logQueue=[]),dust.logQueue.push({message:t,type:e}),logger.log("[DUST "+e+"]: "+t)),!dust.silenceErrors&&e===ERROR)throw"string"==typeof t?new Error(t):t},dust.onError=function(t,e){if(logger.log("[!!!DEPRECATION WARNING!!!]: dust.onError will no longer return a chunk object."),dust.log(t.message||t,ERROR),dust.silenceErrors)return e;throw t},dust.helpers={},dust.cache={},dust.register=function(t,e){t&&(dust.cache[t]=e)},dust.render=function(t,e,n){var o=new Stub(n).head;try{dust.load(t,o,Context.wrap(e,t)).end()}catch(r){dust.log(r,ERROR)}},dust.stream=function(t,e){var n=new Stream;return dust.nextTick(function(){try{dust.load(t,n.head,Context.wrap(e,t)).end()}catch(o){dust.log(o,ERROR)}}),n},dust.renderSource=function(t,e,n){return dust.compileFn(t)(e,n)},dust.compileFn=function(t,e){e=e||null;var n=dust.loadSource(dust.compile(t,e));return function(t,o){var r=o?new Stub(o):new Stream;return dust.nextTick(function(){"function"==typeof n?n(r.head,Context.wrap(t,e)).end():dust.log(new Error("Template ["+e+"] cannot be resolved to a Dust function"),ERROR)}),r}},dust.load=function(t,e,n){var o=dust.cache[t];return o?o(e,n):dust.onLoad?e.map(function(e){dust.onLoad(t,function(o,r){return o?e.setError(o):(dust.cache[t]||dust.loadSource(dust.compile(r,t)),void dust.cache[t](e,n).end())})}):e.setError(new Error("Template Not Found: "+t))},dust.loadSource=function(source,path){return eval(source)},dust.isArray=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},dust.indexInArray=function(t,e,n){if(n=+n||0,Array.prototype.indexOf)return t.indexOf(e,n);if(void 0===t||null===t)throw new TypeError('cannot call method "indexOf" of null');var o=t.length;for(1/0===Math.abs(n)&&(n=0),0>n&&(n+=o,0>n&&(n=0));o>n;n++)if(t[n]===e)return n;return-1},dust.nextTick=function(){return function(t){setTimeout(t,0)}}(),dust.isEmpty=function(t){return dust.isArray(t)&&!t.length?!0:0===t?!1:!t},dust.filter=function(t,e,n){if(n)for(var o=0,r=n.length;r>o;o++){var s=n[o];"s"===s?(e=null,dust.log("Using unescape filter on ["+t+"]",DEBUG)):"function"==typeof dust.filters[s]?t=dust.filters[s](t):dust.log("Invalid filter ["+s+"]",WARN)}return e&&(t=dust.filters[e](t)),t},dust.filters={h:function(t){return dust.escapeHtml(t)},j:function(t){return dust.escapeJs(t)},u:encodeURI,uc:encodeURIComponent,js:function(t){return JSON?JSON.stringify(t):(dust.log("JSON is undefined.  JSON stringify has not been used on ["+t+"]",WARN),t)},jp:function(t){return JSON?JSON.parse(t):(dust.log("JSON is undefined.  JSON parse has not been used on ["+t+"]",WARN),t)}},dust.makeBase=function(t){return new Context(new Stack,t)},Context.wrap=function(t,e){return t instanceof Context?t:new Context(new Stack(t),{},null,e)},Context.prototype.get=function(t,e){return"string"==typeof t&&("."===t[0]&&(e=!0,t=t.substr(1)),t=t.split(".")),this._get(e,t)},Context.prototype._get=function(t,e){var n,o,r,s,i=this.stack,u=1;if(dust.log("Searching for reference [{"+e.join(".")+"}] in template ["+this.getTemplateName()+"]",DEBUG),o=e[0],r=e.length,t&&0===r)s=i,i=i.head;else{if(t)i&&(i=i.head?i.head[o]:void 0);else{for(;i&&(!i.isObject||(s=i.head,n=i.head[o],void 0===n));)i=i.tail;i=void 0!==n?n:this.global?this.global[o]:void 0}for(;i&&r>u;)s=i,i=i[e[u]],u++}if("function"==typeof i){var a=function(){try{return i.apply(s,arguments)}catch(t){return dust.log(t,ERROR)}};return a.isFunction=!0,a}return void 0===i&&dust.log("Cannot find the value for reference [{"+e.join(".")+"}] in template ["+this.getTemplateName()+"]"),i},Context.prototype.getPath=function(t,e){return this._get(t,e)},Context.prototype.push=function(t,e,n){return new Context(new Stack(t,this.stack,e,n),this.global,this.blocks,this.getTemplateName())},Context.prototype.rebase=function(t){return new Context(new Stack(t),this.global,this.blocks,this.getTemplateName())},Context.prototype.current=function(){return this.stack.head},Context.prototype.getBlock=function(t){if("function"==typeof t){var e=new Chunk;t=t(e,this).data.join("")}var n=this.blocks;if(!n)return void dust.log("No blocks for context[{"+t+"}] in template ["+this.getTemplateName()+"]",DEBUG);for(var o,r=n.length;r--;)if(o=n[r][t])return o},Context.prototype.shiftBlocks=function(t){var e,n=this.blocks;return t?(e=n?n.concat([t]):[t],new Context(this.stack,this.global,e,this.getTemplateName())):this},Context.prototype.getTemplateName=function(){return this.templateName},Stub.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.callback(t.error),dust.log("Chunk error ["+t.error+"] thrown. Ceasing to render this template.",WARN),void(this.flush=EMPTY_FUNC)):void 0;this.out+=t.data.join(""),t=t.next,this.head=t}this.callback(null,this.out)},Stream.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.emit("error",t.error),dust.log("Chunk error ["+t.error+"] thrown. Ceasing to render this template.",WARN),void(this.flush=EMPTY_FUNC)):void 0;this.emit("data",t.data.join("")),t=t.next,this.head=t}this.emit("end")},Stream.prototype.emit=function(t,e){if(!this.events)return dust.log("No events to emit",INFO),!1;var n=this.events[t];if(!n)return dust.log("Event type ["+t+"] does not exist",WARN),!1;if("function"==typeof n)n(e);else if(dust.isArray(n))for(var o=n.slice(0),r=0,s=o.length;s>r;r++)o[r](e);else dust.log("Event Handler ["+n+"] is not of a type that is handled by emit",WARN)},Stream.prototype.on=function(t,e){return this.events||(this.events={}),this.events[t]?"function"==typeof this.events[t]?this.events[t]=[this.events[t],e]:this.events[t].push(e):(dust.log("Event type ["+t+"] does not exist. Using just the specified callback.",WARN),e?this.events[t]=e:dust.log("Callback for type ["+t+"] does not exist. Listener not registered.",WARN)),this},Stream.prototype.pipe=function(t){return this.on("data",function(e){try{t.write(e,"utf8")}catch(n){dust.log(n,ERROR)}}).on("end",function(){try{return t.end()}catch(e){dust.log(e,ERROR)}}).on("error",function(e){t.error(e)}),this},Chunk.prototype.write=function(t){var e=this.taps;return e&&(t=e.go(t)),this.data.push(t),this},Chunk.prototype.end=function(t){return t&&this.write(t),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(t){var e=new Chunk(this.root,this.next,this.taps),n=new Chunk(this.root,e,this.taps);return this.next=n,this.flushable=!0,t(n),e},Chunk.prototype.tap=function(t){var e=this.taps;return this.taps=e?e.push(t):new Tap(t),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(t,e){return t(this,e)},Chunk.prototype.reference=function(t,e,n,o){return"function"==typeof t&&(t.isFunction=!0,t=t.apply(e.current(),[this,e,null,{auto:n,filters:o}]),t instanceof Chunk)?t:dust.isEmpty(t)?this:this.write(dust.filter(t,n,o))},Chunk.prototype.section=function(t,e,n,o){if("function"==typeof t&&(t=t.apply(e.current(),[this,e,n,o]),t instanceof Chunk))return t;var r=n.block,s=n["else"];if(o&&(e=e.push(o)),dust.isArray(t)){if(r){var i=t.length,u=this;if(i>0){e.stack.head&&(e.stack.head.$len=i);for(var a=0;i>a;a++)e.stack.head&&(e.stack.head.$idx=a),u=r(u,e.push(t[a],a,i));return e.stack.head&&(e.stack.head.$idx=void 0,e.stack.head.$len=void 0),u}if(s)return s(this,e)}}else if(t===!0){if(r)return r(this,e)}else if(t||0===t){if(r)return r(this,e.push(t))}else if(s)return s(this,e);return dust.log("Not rendering section (#) block in template ["+e.getTemplateName()+"], because above key was not found",DEBUG),this},Chunk.prototype.exists=function(t,e,n){var o=n.block,r=n["else"];if(dust.isEmpty(t)){if(r)return r(this,e)}else if(o)return o(this,e);return dust.log("Not rendering exists (?) block in template ["+e.getTemplateName()+"], because above key was not found",DEBUG),this},Chunk.prototype.notexists=function(t,e,n){var o=n.block,r=n["else"];if(dust.isEmpty(t)){if(o)return o(this,e)}else if(r)return r(this,e);return dust.log("Not rendering not exists (^) block check in template ["+e.getTemplateName()+"], because above key was found",DEBUG),this},Chunk.prototype.block=function(t,e,n){var o=n.block;return t&&(o=t),o?o(this,e):this},Chunk.prototype.partial=function(t,e,n){var o;o=dust.makeBase(e.global),o.blocks=e.blocks,e.stack&&e.stack.tail&&(o.stack=e.stack.tail),n&&(o=o.push(n)),"string"==typeof t&&(o.templateName=t),o=o.push(e.stack.head);var r;return r="function"==typeof t?this.capture(t,o,function(t,e){o.templateName=o.templateName||t,dust.load(t,e,o).end()}):dust.load(t,this,o)},Chunk.prototype.helper=function(t,e,n,o){var r=this;try{return dust.helpers[t]?dust.helpers[t](r,e,n,o):(dust.log("Invalid helper ["+t+"]",WARN),r)}catch(s){return dust.log(s,ERROR),r}},Chunk.prototype.capture=function(t,e,n){return this.map(function(o){var r=new Stub(function(t,e){t?o.setError(t):n(e,o)});t(r.head,e).end()})},Chunk.prototype.setError=function(t){return this.error=t,this.root.flush(),this},Tap.prototype.push=function(t){return new Tap(t,this)},Tap.prototype.go=function(t){for(var e=this;e;)t=e.head(t),e=e.tail;return t};var HCHARS=new RegExp(/[&<>\"\']/),AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(t){return"string"==typeof t?HCHARS.test(t)?t.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):t:t};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(t){return"string"==typeof t?t.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):t},"object"==typeof exports?module.exports=dust:root.dust=dust}(this);
//# sourceMappingURL=dust-core.js.map